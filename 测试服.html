<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>工效数据分析</title>
    <include file="Public/bootstrap_js_css"/>
</head>
<body>
{$Bread}
<div class='panel'>
    <form action="/brandstore/analysis/index" method="get">
        <legend>工效数据分析</legend>
        <div class="row cl" id="work">
            <label class="form-label col-xs-1">按工位</label>
            <div class="formControls col-xs-11">
                <?php if($work):?>
                    <?php foreach($work as $v):?>
                        <label class='form-check-btn'>
                        <input type="checkbox" name="work[]" value="<?= $v['id']?>" <?php if($_GET['work']){
                            $w = array_flip($_GET['work']);
                            if($w){
                                if(array_key_exists($v['id'],$w)){
                                    echo 'checked';
                                }
                            }
                        }?> >
                        <?= $v['name']?>
                        </label>
                    <?php endforeach;?>
                <?php endif;?>
            </div>
        </div>
        <div class="row cl" id="service">
            <label class="form-label col-xs-1">按项目</label>
            <div class="formControls col-xs-11">
                <?php if($service):?>
                    <?php foreach($service as $v):?>
                        <label class='form-check-btn disabled'>
                        <input type="checkbox" name="service[]" value="<?= $v['id']?>"<?php if($_GET['service']){
                            $s = array_flip($_GET['service']);
                            if($s){
                                if(array_key_exists($v['id'],$s)){
                                    echo 'checked';
                                }
                            }
                        }?> >
                        <?= $v['name'];?>
                        </label>
                    <?php endforeach;?>
                <?php endif;?>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-1">时间范围</label>
            <div class="formControls col-xs-11">
                <input id="datemin" class="input-text Wdate" name="start_time" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',maxDate:'#F{ $dp.$D(\'datemax\')}'})" value="<?= $_GET['start_time'];?>" style="width:180px;" type="text">
                -
                <input id="datemax" class="input-text Wdate" name="end_time" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss',minDate:'#F{ $dp.$D(\'datemin\')}'})" value="<?= $_GET['end_time'];?>" style="width:180px;" type="text">
                &nbsp;&nbsp;
                <input type="submit" value="查询" class="btn btn-skin">
            </div>
        </div>
    </form>
    <table class="table table-border table-bordered table-hover table-bg">
        <thead>
        <tr class="text-c">
            <!--<th><input type="checkbox" name="" value=""></th>-->
            <th>序号</th>
            <th>工位名称</th>
            <th>班组长</th>
            <th>车牌号码</th>
            <th>服务项目</th>
            <th>服务用时（分钟）</th>
            <th>进入工位时间</th>
            <th>离开工位时间</th>
        </tr>
        </thead>
        <tbody>
            <?php if($data):?>
                <?php foreach($data as $k => $v):?>
                    <tr class="text-c">
                        <td>
                            <?php $p = $_GET['goonPageNum'] + 0 ; if($p <= 0){ $p = 1; } $p = $p - 1;?>
                            <?= ($k + 1) + $p * 15;?>
                            <input type="hidden" value="<?= $v['type_id'];?>">
                        </td>
                        <td>
                            <?= $v['name'];?><br>
                        </td>
                        <td>
                            <?= $v['realname'];?>
                        </td>
                        <td>
                            <?= $v['carnum'];?>
                        </td>
                        <td>
                            <?= $v['service'];?>
                        </td>
                        <td>
                            <?= $v['duration'];?>
                        </td>
                        <td>
                            <?php if($v['starttime']):?>
                            <?= date('Y-m-d H:i:s',$v['starttime']);?>
                            <?php endif;?>
                        </td>
                        <td>
                            <?php if($v['endtime']):?>
                            <?= date('Y-m-d H:i:s',$v['endtime']);?>
                            <?php endif;?>
                        </td>
                    </tr>
                <?php endforeach;?>
                    <tr class="text-c">
                        {$page}
                    </tr>
            <?php else:?>
            <tr class="text-c">
                <td colspan="8">
                    抱歉，没有找到相关数据。
                </td>
            </tr>
            <?php endif;?>
        </tbody>
    </table>
    <div id="myTabContent" class="tab-content">
        <iframe src="/brandstore/analysis/countchart" frameborder="0" id="iframe2" width="100%" height="550"></iframe>
    </div>
</div>
</body>
</html>
<script type="text/javascript">
    $('form').on('click','label input:checkbox',function () {
        if($(this).closest('label').hasClass('disabled')){
            return;
        }
        var name = $(this).attr('name');
        $(this).closest('label').parent().find('input:checkbox').each(function () {
            if($(this).attr('name')==name){
                if($(this).prop('checked')){
                    $(this).closest('label').addClass('selected');
                }else{
                    $(this).closest('label').removeClass('selected');
                }
            }
        });
    })
</script>